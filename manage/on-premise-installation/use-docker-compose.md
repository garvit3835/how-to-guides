# Use Docker Compose

### Minimum requirements for the Aviator server

* [x] 4 CPU
* [x] 8 GB memory
* [x] 25 GB storage

### Prerequisites

1. Ubuntu or Debian installation on the box.
   * You need to be able to SSH or have a console access to it.
   * You need a root access on it.
   * Docker engine needs to be installed. You can follow instructions [<mark style="color:blue;">here</mark>](https://docs.docker.com/engine/install/ubuntu/).
2. The secrets file provided by Aviator.
3. A domain name that can be assigned to the Linux box.

### Variable definitions

`$GITHUB_URL`: Hostname where GitHub is hosted

`$AV_HOSTNAME`: Hostname where Aviator is hosted (e.g. `aviator.example.com`)

`$GITHUB_APP_ID`: ID generated when a GitHub app is created

`$MERGEQUEUE_PEM_FILE`: Private key generated by GitHub for Aviator

### Step 1

Configure the DNS records so that `$AV_HOSTNAME` points to your Linux box. Depending on your DNS, this may take some time to propagate. Make sure the hostname resolves before moving on.

### Step 2

Follow [<mark style="color:blue;">GitHub App for On-Prem</mark>](github-app-for-on-prem.md) to create `$GITHUB_APP_ID` and `$MERGEQUEUE_PEM_FILE`.

### Step 3

Verify that Docker engine is installed and running, otherwise follow the instructions [<mark style="color:blue;">here</mark>](https://docs.docker.com/engine/install/ubuntu/) to install.

### Step 4

Create `/opt/mergequeue/keys` directory and copy `$MERGEQUEUE_PEM_FILE` there. The file name must be `mergequeue.pem`.

```shell
$ sudo mkdir -p /opt/mergequeue/keys
$ sudo mv mergequeue.pem /opt/mergequeue/keys/
$ sudo chmod 0644 /opt/mergequeue/keys/mergequeue.pem
```

### Step 5

Extract the `aviator.zip` file provided by us, and open `enterprise/install.sh` in your favorite editor. There are configs around the top of the script. You will need to modify the variables there. Here are some details for each secret value:

<table><thead><tr><th width="262.54385964912285">Value</th><th>Description</th></tr></thead><tbody><tr><td><code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code></td><td>Provided in the secrets file, used to pull Docker images.</td></tr><tr><td><code>LICENSE_KEY</code></td><td>Provided in the secrets file.</td></tr><tr><td><code>CERT_EMAIL</code></td><td>Email used by LetsEncrypt. This is where you will get emails about expiring certificates. During our setup of LetsEncrypt certificate, we also enable auto-renewal cron.</td></tr><tr><td><code>GITHUB_URL</code></td><td>Same as <code>$GITHUB_URL</code>. This is only the hostname without any “https://” and any trailing slashes.</td></tr><tr><td><code>HOSTNAME</code></td><td>Same as <code>$AV_HOSTNAME</code>. This is only the hostname of Aviator server without any “https://” and any trailing slashes.</td></tr><tr><td><code>GITHUB_APP_ID</code></td><td>The same <code>$GITHUB_APP_ID</code> mentioned in Step 3.</td></tr><tr><td><code>SUMO_ACCESS_ID</code>, <code>SUMO_ACCESS_KEY</code></td><td>We use sumo logic for log tracking. These values should be provided to you in the keys.</td></tr></tbody></table>

Save the file.

### Step 6

Once the configurations above are set, run the install script. This will pull, build and start all the docker containers required for the Aviator service.

```shell
$ ./install.sh
```

At the end of that script, it will run _docker-compose up -d_ to start the containers as detached. You can verify that the containers are running by:

```shell
$ sudo docker-compose ps
```

At this point, you should be able to open `$AV_HOSTNAME` in the browser.

### Step 7

Once the page loads, you can go and register a new account from the following url on the app and follow the instructions.

```
https://$AV_HOSTNAME/register
```

It will guide you to connect the GitHub Repository with the GitHub app you created. Once authorized, you should see the connected repositories on your Repository page.

Use the same account for all purposes. You can invite other team members to this account from the Account / Users and Roles section.

Note that registering multiple accounts is disabled for on-prem, if you need additional accounts please contact support@aviator.co.

### Troubleshooting

If the setup above fails, or docker fails to start containers, please reach out to the Aviator team. And share the output of install script along with logs from docker-compose:

```shell
$ sudo docker-compose logs
```
